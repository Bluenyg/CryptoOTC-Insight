<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ™ºè¡Œé…’åº— Pro - å®Œæ•´äº¤äº’ç‰ˆ</title>
    <style>
        /* --- 1. å…¨å±€æ ·å¼ (System Design) --- */
        :root {
            --primary: #2563eb;
            --primary-light: #eff6ff;
            --text-main: #111827;
            --text-sub: #6b7280;
            --bg-body: #f9fafb;
            --white: #ffffff;
            --border: #e5e7eb;
            --danger: #ef4444;
            --success: #10b981;
            --warning: #f59e0b;
            --radius: 12px;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; -webkit-tap-highlight-color: transparent; }

        body { background-color: var(--bg-body); color: var(--text-main); max-width: 480px; margin: 0 auto; min-height: 100vh; padding-bottom: 80px; /* ç•™å‡ºåº•éƒ¨å¯¼èˆªç©ºé—´ */ position: relative; overflow-x: hidden; box-shadow: 0 0 20px rgba(0,0,0,0.05); }

        /* --- 2. å¯¼èˆªæ  --- */
        .navbar { background: var(--white); padding: 15px; position: sticky; top: 0; z-index: 50; display: flex; align-items: center; justify-content: space-between; border-bottom: 1px solid var(--border); }
        .nav-title { font-weight: 700; font-size: 17px; }
        .back-icon { font-size: 20px; padding-right: 15px; cursor: pointer; }

        /* --- 3. é¡µé¢å®¹å™¨ä¸è½¬åœº --- */
        .page { display: none; padding: 15px; animation: slideUp 0.3s ease-out; }
        .page.active { display: block; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- 4. ç»„ä»¶åº“ --- */
        .card { background: var(--white); border-radius: var(--radius); padding: 16px; margin-bottom: 12px; box-shadow: 0 1px 2px rgba(0,0,0,0.05); }
        .btn { width: 100%; padding: 14px; border: none; border-radius: 8px; background: var(--primary); color: white; font-weight: 600; font-size: 16px; cursor: pointer; transition: 0.2s; }
        .btn:active { transform: scale(0.98); }
        .btn-outline { background: transparent; border: 1px solid var(--border); color: var(--text-main); }
        .btn-danger { background: var(--danger); }
        .btn-small { padding: 6px 12px; font-size: 13px; width: auto; }

        .tag { display: inline-block; padding: 4px 8px; border-radius: 4px; font-size: 12px; margin-right: 5px; background: #f3f4f6; color: var(--text-sub); }
        .tag.blue { background: var(--primary-light); color: var(--primary); }

        /* è¾“å…¥æ¡†ç»„ */
        .input-group { margin-bottom: 15px; }
        .input-group label { display: block; font-size: 13px; color: var(--text-sub); margin-bottom: 6px; }
        .input-box { width: 100%; padding: 12px; border: 1px solid var(--border); border-radius: 8px; font-size: 15px; background: var(--white); outline: none; }
        .input-box:focus { border-color: var(--primary); }

        /* --- 5. åº•éƒ¨å¯¼èˆªæ  (Bottom Tab Bar) --- */
        .tab-bar { position: fixed; bottom: 0; left: 0; right: 0; max-width: 480px; margin: 0 auto; background: var(--white); border-top: 1px solid var(--border); display: flex; justify-content: space-around; padding: 10px 0; z-index: 100; }
        .tab-item { display: flex; flex-direction: column; align-items: center; color: var(--text-sub); font-size: 10px; cursor: pointer; flex: 1; }
        .tab-item.active { color: var(--primary); }
        .tab-icon { font-size: 20px; margin-bottom: 2px; }

        /* --- 6. å¼¹çª— (Modals) --- */
        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 200; display: none; align-items: flex-end; }
        .modal-overlay.show { display: flex; }
        .bottom-sheet { background: var(--white); width: 100%; border-radius: 20px 20px 0 0; padding: 20px; max-width: 480px; margin: 0 auto; animation: slideUpModal 0.3s; max-height: 80vh; overflow-y: auto; }
        @keyframes slideUpModal { from { transform: translateY(100%); } to { transform: translateY(0); } }

        /* --- ç‰¹å®šé¡µé¢æ ·å¼ --- */

        /* æœç´¢ç­›é€‰ */
        .filter-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-bottom: 15px; }
        .filter-btn { padding: 8px; text-align: center; border: 1px solid var(--border); border-radius: 6px; font-size: 12px; cursor: pointer; }
        .filter-btn.selected { border-color: var(--primary); color: var(--primary); background: var(--primary-light); }

        /* é…’åº—åˆ—è¡¨ */
        .hotel-item { display: flex; gap: 12px; }
        .hotel-thumb { width: 100px; height: 110px; border-radius: 8px; object-fit: cover; background: #eee; }
        .hotel-content { flex: 1; display: flex; flex-direction: column; justify-content: space-between; }
        .price-text { color: var(--danger); font-size: 18px; font-weight: 700; }

        /* è¯¦æƒ…é¡µ */
        .gallery { display: flex; overflow-x: auto; gap: 10px; padding-bottom: 10px; scroll-snap-type: x mandatory; }
        .gallery img { width: 280px; height: 180px; border-radius: 8px; scroll-snap-align: center; object-fit: cover; }
        .map-preview { height: 80px; background: #e5e7eb; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: var(--text-sub); font-size: 12px; margin: 10px 0; }

        /* è®¢å•çŠ¶æ€ */
        .order-status { font-size: 14px; font-weight: bold; }
        .status-unpaid { color: var(--danger); }
        .status-paid { color: var(--success); }
        .status-refunded { color: var(--text-sub); text-decoration: line-through; }

        /* Toast æç¤º */
        #toast { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(0,0,0,0.8); color: white; padding: 12px 24px; border-radius: 8px; font-size: 14px; z-index: 1000; display: none; text-align: center; }

    </style>
</head>
<body>

    <nav class="navbar" id="navbar">
        <div class="back-icon" onclick="history.back()" id="nav-back" style="display:none;">&#8592;</div>
        <div class="nav-title" id="nav-title">æ™ºè¡Œé…’åº—</div>
        <div style="font-size: 20px;">&#8942;</div>
    </nav>

    <div id="app-content">

        <div id="page-home" class="page active">
            <div class="card" style="background: linear-gradient(135deg, #2563eb, #1d4ed8); color: white; border:none;">
                <h2>å¼€å¯æ‚¨çš„æ—…ç¨‹ ğŸŒ</h2>
                <p style="opacity: 0.9; font-size: 13px; margin-top: 5px;">å…¨ç½‘æ¯”ä»· Â· æ™ºèƒ½æ¨è Â· æ— å¿§é€€æ”¹</p>
            </div>

            <div class="card">
                <div class="input-group" style="border-bottom: 1px solid #f3f4f6; padding-bottom: 10px;">
                    <label>ç›®çš„åœ°</label>
                    <div style="font-size: 18px; font-weight: 600;">åŒ—äº¬å¸‚, æœé˜³åŒº <span style="font-size:12px; color:gray; font-weight:normal;">ğŸ“ å®šä½ä¸­</span></div>
                </div>

                <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                    <div style="flex: 1;">
                        <label style="font-size:12px; color:gray;">å…¥ä½</label>
                        <div style="font-weight:600;">11æœˆ25æ—¥ <span style="font-size:12px; color:gray;">å‘¨ä¸€</span></div>
                    </div>
                    <div style="flex: 1; border-left: 1px solid #eee; padding-left: 10px;">
                        <label style="font-size:12px; color:gray;">ç¦»åº—</label>
                        <div style="font-weight:600;">11æœˆ26æ—¥ <span style="font-size:12px; color:gray;">å‘¨äºŒ</span></div>
                    </div>
                </div>

                <div class="input-group">
                    <label>ç­›é€‰åå¥½ (ä»·æ ¼/æ˜Ÿçº§)</label>
                    <input type="text" class="input-box" placeholder="Â¥0-500, ä¸‰æ˜Ÿ/èˆ’é€‚" readonly onclick="showFilterModal()">
                </div>

                <button class="btn" onclick="router.push('page-list')">ğŸ” ç«‹å³æœç´¢</button>
            </div>

            <div style="padding: 0 5px;">
                <h3 style="font-size: 15px; margin-bottom: 10px;">å½“å­£ç‰¹æƒ  ğŸ”¥</h3>
                <div style="display: flex; overflow-x: scroll; gap: 10px; padding-bottom: 10px;">
                    <div style="min-width: 140px; background: white; border-radius: 8px; padding: 10px;">
                        <div style="height: 80px; background: #eee; border-radius: 6px; margin-bottom: 5px;"></div>
                        <div style="font-size: 13px; font-weight: bold;">æƒ…ä¾£åº¦å‡å¥—ç¥¨</div>
                        <div style="color: var(--danger); font-size: 12px;">Â¥699 èµ·</div>
                    </div>
                    <div style="min-width: 140px; background: white; border-radius: 8px; padding: 10px;">
                        <div style="height: 80px; background: #eee; border-radius: 6px; margin-bottom: 5px;"></div>
                        <div style="font-size: 13px; font-weight: bold;">äº²å­ä¹å›­æˆ¿</div>
                        <div style="color: var(--danger); font-size: 12px;">Â¥899 èµ·</div>
                    </div>
                </div>
            </div>
        </div>

        <div id="page-list" class="page">
            <div style="display: flex; gap: 10px; margin-bottom: 10px; position: sticky; top: 0; background: var(--bg-body); padding: 5px 0; z-index: 10;">
                <button class="btn-outline btn-small" style="background:white;">ç»¼åˆæ’åº â–¾</button>
                <button class="btn-outline btn-small" style="background:white;">ä»·æ ¼æœ€ä½</button>
                <button class="btn-outline btn-small" style="background:white;">è·ç¦»æœ€è¿‘</button>
                <button class="btn-outline btn-small" style="background:white;">ç­›é€‰ â–¾</button>
            </div>

            <div class="card hotel-item" onclick="router.push('page-detail', {name: 'åŒ—äº¬å›½è´¸å¤§é…’åº—', price: 1288})">
                <img src="https://placehold.co/100x110/2563eb/white?text=Hotel+A" class="hotel-thumb">
                <div class="hotel-content">
                    <div>
                        <div style="font-weight: bold; font-size: 16px;">åŒ—äº¬å›½è´¸å¤§é…’åº—</div>
                        <div style="font-size: 12px; color: var(--text-sub); margin: 4px 0;">ğŸ“ å»ºå›½é—¨å¤–å¤§è¡— | è·åœ°é“200ç±³</div>
                        <div style="font-size: 12px; color: var(--primary);">ğŸ’ è±ªåå‹ Â· 4.9åˆ† (2300è¯„ä»·)</div>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: flex-end;">
                        <div class="tag">å•†åŠ¡å‡ºè¡Œ</div>
                        <div class="price-text">Â¥1288</div>
                    </div>
                </div>
            </div>

            <div class="card hotel-item" onclick="router.push('page-detail', {name: 'äºšæœµSé…’åº— (CBDåº—)', price: 650})">
                <img src="https://placehold.co/100x110/10b981/white?text=Hotel+B" class="hotel-thumb">
                <div class="hotel-content">
                    <div>
                        <div style="font-weight: bold; font-size: 16px;">äºšæœµSé…’åº— (CBDåº—)</div>
                        <div style="font-size: 12px; color: var(--text-sub); margin: 4px 0;">ğŸ“ åŒäº• | å…è´¹åœè½¦</div>
                        <div style="font-size: 12px; color: var(--primary);">âœ¨ é«˜æ¡£å‹ Â· 4.8åˆ† (5000+è¯„ä»·)</div>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: flex-end;">
                        <div class="tag">æ€§ä»·æ¯”</div>
                        <div class="price-text">Â¥650</div>
                    </div>
                </div>
            </div>
        </div>

        <div id="page-detail" class="page">
            <div class="gallery">
                <img src="https://placehold.co/280x180/2563eb/white?text=Lobby" alt="å¤§å ‚">
                <img src="https://placehold.co/280x180/2563eb/white?text=Room" alt="å®¢æˆ¿">
                <img src="https://placehold.co/280x180/2563eb/white?text=Pool" alt="æ³³æ± ">
            </div>

            <div class="card">
                <h2 id="detail-name" style="margin-bottom: 5px;">é…’åº—åç§°</h2>
                <div style="font-size: 12px; color: var(--text-sub); display: flex; align-items: center; gap: 5px;">
                    <span>â­â­â­â­â­</span>
                    <span>â€œæœåŠ¡æ€åº¦è¶…å¥½â€</span>
                    <span>â€œæ—©é¤ä¸°å¯Œâ€</span>
                </div>
                <div class="map-preview">ğŸ—ºï¸ æŸ¥çœ‹åœ°å›¾ä¸å‘¨è¾¹ (è·æ‚¨ç›´çº¿1.5km)</div>
                <div style="display: flex; gap: 10px;">
                    <button class="btn-outline btn-small" style="flex:1;">ğŸ’¬ è”ç³»å®¢æœ</button>
                    <button class="btn-outline btn-small" style="flex:1;">â­ æ”¶è—</button>
                </div>
            </div>

            <h3 style="font-size: 16px; margin: 15px 5px;">æˆ¿å‹é€‰æ‹©</h3>

            <div class="card" style="display: flex; justify-content: space-between; align-items: center;">
                <div style="flex: 1;">
                    <div style="font-weight: bold;">è±ªåå¤§åºŠæˆ¿</div>
                    <div style="font-size: 12px; color: var(--text-sub); margin-top: 4px;">35ã¡ | åŒæ—© | æœ‰çª— | æµ´ç¼¸</div>
                    <div style="font-size: 12px; color: var(--warning); margin-top: 2px;">ä¸å¯å–æ¶ˆ</div>
                </div>
                <div style="text-align: right;">
                    <div class="price-text" id="room-price-1">Â¥0</div>
                    <button class="btn btn-small" style="margin-top: 5px;" onclick="router.push('page-booking', {roomType: 'è±ªåå¤§åºŠæˆ¿'})">é¢„è®¢</button>
                </div>
            </div>
             <div class="card" style="display: flex; justify-content: space-between; align-items: center;">
                <div style="flex: 1;">
                    <div style="font-weight: bold;">è¡Œæ”¿å¥—æˆ¿</div>
                    <div style="font-size: 12px; color: var(--text-sub); margin-top: 4px;">60ã¡ | è¡Œæ”¿ç¤¼é‡ | é«˜å±‚è§†é‡</div>
                    <div style="font-size: 12px; color: var(--success); margin-top: 2px;">é™æ—¶å…è´¹å–æ¶ˆ</div>
                </div>
                <div style="text-align: right;">
                    <div class="price-text" id="room-price-2">Â¥0</div>
                    <button class="btn btn-small" style="margin-top: 5px;" onclick="router.push('page-booking', {roomType: 'è¡Œæ”¿å¥—æˆ¿'})">é¢„è®¢</button>
                </div>
            </div>
        </div>

        <div id="page-booking" class="page">
            <div class="card" style="background: var(--primary-light);">
                <div style="font-size: 12px; color: var(--primary);">â±ï¸ æˆ¿é—´ç´§å¼ ï¼Œè¯·åœ¨ 15:00 åˆ†é’Ÿå†…å®Œæˆæ”¯ä»˜</div>
            </div>

            <div class="card">
                <h3 id="book-hotel" style="margin-bottom: 5px;"></h3>
                <div id="book-room" style="font-size: 14px; color: var(--text-sub);"></div>
                <div style="font-size: 13px; margin-top: 10px; display: flex; justify-content: space-between;">
                    <span>å…¥ä½: 11-25</span>
                    <span>ç¦»åº—: 11-26</span>
                    <span>1æ™š</span>
                </div>
            </div>

            <div class="card">
                <div class="input-group">
                    <label>ä½å®¢å§“å</label>
                    <input type="text" class="input-box" value="å¼ ä¸‰" placeholder="å¡«å†™å…¥ä½äººå§“å">
                </div>
                <div class="input-group" style="margin-bottom: 0;">
                    <label>è”ç³»æ‰‹æœº</label>
                    <input type="tel" class="input-box" value="13800138000" placeholder="æ¥æ”¶ç¡®è®¤çŸ­ä¿¡">
                </div>
            </div>

            <div class="card">
                <div style="display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #eee;" onclick="showCouponModal()">
                    <span>ğŸ§§ ä¼˜æƒ ç¦åˆ©</span>
                    <span style="color: var(--danger); cursor: pointer;">-Â¥50 ä¼˜æƒ åˆ¸ ></span>
                </div>
                <div style="display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #eee;" onclick="showPolicyModal()">
                    <span>ğŸ“œ é€€è®¢æ”¿ç­–</span>
                    <span style="color: var(--primary); cursor: pointer;">æŸ¥çœ‹è§„åˆ™ ></span>
                </div>
                <div style="display: flex; justify-content: space-between; padding: 10px 0;">
                    <span>å‘ç¥¨</span>
                    <span style="color: var(--text-sub);">å¦‚éœ€å‘ç¥¨è¯·åœ¨å‰å°é¢†å–</span>
                </div>
            </div>

            <div style="position: fixed; bottom: 0; left: 0; right: 0; background: white; padding: 10px 15px; border-top: 1px solid #eee; display: flex; align-items: center; justify-content: space-between; z-index: 60; max-width: 480px; margin: 0 auto;">
                <div>
                    <span style="font-size: 12px; color: gray;">æ€»è®¡æ¶ˆè´¹:</span>
                    <span class="price-text" id="final-price">Â¥0</span>
                </div>
                <button class="btn" style="width: auto; padding: 10px 30px;" onclick="processPayment()">æäº¤è®¢å•</button>
            </div>
        </div>

        <div id="page-orders" class="page">
            <h2 style="margin-bottom: 15px;">æˆ‘çš„è®¢å•</h2>

            <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                <span class="tag blue">å…¨éƒ¨</span>
                <span class="tag">å¾…å…¥ä½</span>
                <span class="tag">å¾…è¯„ä»·</span>
                <span class="tag">é€€æ¬¾/å”®å</span>
            </div>

            <div id="order-list-container">
                <div style="text-align: center; color: gray; padding-top: 50px;">
                    æš‚æ— æ–°è®¢å•ï¼Œå»é¢„è®¢ä¸€ä¸ªå§ï¼
                </div>
            </div>
        </div>

    </div>

    <div class="tab-bar">
        <div class="tab-item active" onclick="switchTab('home')">
            <div class="tab-icon">ğŸ </div>
            <div>é¦–é¡µ</div>
        </div>
        <div class="tab-item" onclick="switchTab('list')">
            <div class="tab-icon">ğŸ”</div>
            <div>æœç´¢</div>
        </div>
        <div class="tab-item" onclick="switchTab('orders')">
            <div class="tab-icon">ğŸ§¾</div>
            <div>è®¢å•</div>
        </div>
        <div class="tab-item">
            <div class="tab-icon">ğŸ‘¤</div>
            <div>æˆ‘çš„</div>
        </div>
    </div>

    <div class="modal-overlay" id="filter-modal" onclick="closeModal('filter-modal')">
        <div class="bottom-sheet" onclick="event.stopPropagation()">
            <h3>æ›´å¤šç­›é€‰</h3>
            <label style="margin-top:15px; display:block;">ä»·æ ¼åŒºé—´</label>
            <input type="range" style="width:100%; margin: 10px 0;" min="0" max="2000">
            <div style="display:flex; justify-content:space-between; font-size:12px; color:gray;">
                <span>Â¥0</span><span>Â¥2000+</span>
            </div>

            <label style="margin-top:15px; display:block; margin-bottom:10px;">æ˜Ÿçº§æœåŠ¡</label>
            <div class="filter-grid">
                <div class="filter-btn">ç»æµå‹</div>
                <div class="filter-btn selected">èˆ’é€‚/ä¸‰æ˜Ÿ</div>
                <div class="filter-btn">é«˜æ¡£/å››æ˜Ÿ</div>
                <div class="filter-btn">è±ªå/äº”æ˜Ÿ</div>
            </div>
            <button class="btn" onclick="closeModal('filter-modal')">ç¡®è®¤ç­›é€‰</button>
        </div>
    </div>

    <div class="modal-overlay" id="policy-modal" onclick="closeModal('policy-modal')">
        <div class="bottom-sheet" onclick="event.stopPropagation()">
            <h3>é€€è®¢æ”¿ç­– (Rule)</h3>
            <div style="margin: 20px 0; font-size: 14px; line-height: 1.6; color: var(--text-sub);">
                <p>1. <strong>å…è´¹å–æ¶ˆï¼š</strong> å…¥ä½å½“å¤© 18:00 å‰å¯å…è´¹å–æ¶ˆã€‚</p>
                <p>2. <strong>æ‰£è´¹è§„åˆ™ï¼š</strong> è¶…è¿‡æ—¶é—´å–æ¶ˆï¼Œå°†æ‰£é™¤é¦–æ™šæˆ¿è´¹ä½œä¸ºè¿çº¦é‡‘ã€‚</p>
                <p>3. <strong>çªå‘æƒ…å†µï¼š</strong> å¦‚é‡ä¸å¯æŠ—åŠ›ï¼ˆå¦‚è‡ªç„¶ç¾å®³ï¼‰ï¼Œè¯·è”ç³»å®¢æœç”³è¯·å…¨é¢é€€æ¬¾ã€‚</p>
            </div>
            <button class="btn" onclick="closeModal('policy-modal')">æˆ‘çŸ¥é“äº†</button>
        </div>
    </div>

    <div class="modal-overlay" id="coupon-modal" onclick="closeModal('coupon-modal')">
        <div class="bottom-sheet" onclick="event.stopPropagation()">
            <h3>é€‰æ‹©ä¼˜æƒ åˆ¸</h3>
            <div class="card" style="border: 1px solid var(--danger); background: #fff5f5; margin-top: 15px;">
                <div style="font-weight: bold; color: var(--danger);">Â¥50 æ–°äººä¸“äº«åˆ¸</div>
                <div style="font-size: 12px; color: gray;">æ»¡500å¯ç”¨ï¼Œæœ‰æ•ˆæœŸè‡³å¹´åº•</div>
            </div>
            <button class="btn" onclick="closeModal('coupon-modal')">ç¡®è®¤ä½¿ç”¨</button>
        </div>
    </div>

    <div class="modal-overlay" id="review-modal" onclick="closeModal('review-modal')">
        <div class="bottom-sheet" onclick="event.stopPropagation()">
            <h3>å…¥ä½è¯„ä»·</h3>
            <div style="font-size: 24px; text-align: center; margin: 15px 0;">â­â­â­â­â­</div>
            <textarea class="input-box" rows="4" placeholder="åˆ†äº«æ‚¨çš„å…¥ä½ä½“éªŒ..."></textarea>
            <button class="btn" style="margin-top: 10px;" onclick="submitReview()">æäº¤è¯„ä»·</button>
        </div>
    </div>

    <div id="toast">æç¤ºä¿¡æ¯</div>

    <script>
        // --- å…¨å±€æ•°æ® Store ---
        const state = {
            currentHotel: { name: '', price: 0 },
            currentRoom: { name: '', price: 0 },
            orders: [], // å­˜å‚¨è®¢å•å¯¹è±¡ï¼š{ id, hotel, room, price, status, date }
            // status: 'upcoming' (å¾…å…¥ä½), 'completed' (å·²å®Œæˆ), 'refunded' (å·²é€€æ¬¾)
        };

        // --- è·¯ç”±ä¸å¯¼èˆªç³»ç»Ÿ ---
        const router = {
            push: function(pageId, data = {}) {
                // ä¼ å‚å¤„ç†
                if(data.name) state.currentHotel = { ...state.currentHotel, ...data };
                if(data.price) state.currentHotel.price = data.price;
                if(data.roomType) {
                    state.currentRoom.name = data.roomType;
                    // ç®€å•çš„ä»·æ ¼é€»è¾‘ï¼šå¥—æˆ¿åŠ ä»·
                    state.currentRoom.price = data.roomType.includes('å¥—æˆ¿') ? state.currentHotel.price + 600 : state.currentHotel.price;
                }

                // æ¸²æŸ“é¡µé¢æ•°æ®
                renderPage(pageId);

                // åˆ‡æ¢è§†å›¾
                document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
                document.getElementById(pageId).classList.add('active');

                // æ›´æ–°é¡¶éƒ¨å¯¼èˆªçŠ¶æ€
                document.getElementById('nav-back').style.display = pageId === 'page-home' ? 'none' : 'block';
                if(pageId === 'page-home') document.getElementById('navbar').style.display = 'none'; // é¦–é¡µæ²‰æµ¸å¼
                else document.getElementById('navbar').style.display = 'flex';

                window.scrollTo(0,0);
            }
        };

        // Tab åˆ‡æ¢é€»è¾‘
        function switchTab(tabName) {
            document.querySelectorAll('.tab-item').forEach(t => t.classList.remove('active'));
            event.currentTarget.classList.add('active');

            if (tabName === 'home') router.push('page-home');
            if (tabName === 'list') router.push('page-list');
            if (tabName === 'orders') {
                renderOrderList();
                router.push('page-orders');
            }
        }

        // --- é¡µé¢æ¸²æŸ“é€»è¾‘ ---
        function renderPage(pageId) {
            if (pageId === 'page-detail') {
                document.getElementById('detail-name').innerText = state.currentHotel.name;
                document.getElementById('room-price-1').innerText = `Â¥${state.currentHotel.price}`;
                document.getElementById('room-price-2').innerText = `Â¥${state.currentHotel.price + 600}`;
            }
            if (pageId === 'page-booking') {
                document.getElementById('book-hotel').innerText = state.currentHotel.name;
                document.getElementById('book-room').innerText = state.currentRoom.name;
                // å‡å»ä¼˜æƒ åˆ¸50
                document.getElementById('final-price').innerText = `Â¥${state.currentRoom.price - 50}`;
            }
        }

        // --- æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼šæ”¯ä»˜ä¸ç”Ÿæˆè®¢å• ---
        function processPayment() {
            showToast("æ­£åœ¨è¯·æ±‚æ”¯ä»˜ç½‘å…³...");
            setTimeout(() => {
                showToast("æ”¯ä»˜æˆåŠŸï¼çŸ­ä¿¡ç¡®è®¤å·²å‘é€ âœ…");

                // åˆ›å»ºæ–°è®¢å•
                const newOrder = {
                    id: 'H' + Date.now().toString().slice(-6),
                    hotel: state.currentHotel.name,
                    room: state.currentRoom.name,
                    price: state.currentRoom.price - 50,
                    status: 'upcoming', // åˆå§‹çŠ¶æ€ï¼šå¾…å…¥ä½
                    date: new Date().toLocaleDateString()
                };
                state.orders.unshift(newOrder); // åŠ å…¥åˆ—è¡¨å¤´éƒ¨

                // è·³è½¬åˆ°è®¢å•é¡µ
                setTimeout(() => {
                    switchTab('orders'); // è‡ªåŠ¨åˆ‡æ¢ tab æ ·å¼
                    renderOrderList();
                    router.push('page-orders');
                }, 1000);
            }, 1500);
        }

        // --- æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼šè®¢å•åˆ—è¡¨æ¸²æŸ“ (åŒ…å«å”®åæ“ä½œ) ---
        function renderOrderList() {
            const container = document.getElementById('order-list-container');
            container.innerHTML = '';

            if (state.orders.length === 0) {
                container.innerHTML = '<div style="text-align: center; color: gray; padding-top: 50px;">æš‚æ— è®¢å•</div>';
                return;
            }

            state.orders.forEach((order, index) => {
                // æ ¹æ®çŠ¶æ€ç”Ÿæˆä¸åŒçš„æŒ‰é’®
                let actionButtons = '';
                let statusText = '';
                let statusClass = '';

                if (order.status === 'upcoming') {
                    statusText = 'å¾…å…¥ä½';
                    statusClass = 'status-paid';
                    // å¯¹åº”æµç¨‹å›¾ï¼šæ—¥ç¨‹æé†’ã€è‡ªèº«çªå‘æƒ…å†µ(é€€æ¬¾)
                    actionButtons = `
                        <button class="btn-outline btn-small" onclick="addToCalendar()">ğŸ“… æ·»åŠ åˆ°æ—¥å†</button>
                        <button class="btn-outline btn-small" style="color:var(--danger); border-color:var(--danger);" onclick="applyRefund(${index})">é€€æ¬¾/å–æ¶ˆ</button>
                        <button class="btn btn-small" onclick="checkInAction()">åŠç†å…¥ä½</button>
                    `;
                } else if (order.status === 'refunded') {
                    statusText = 'å·²é€€æ¬¾';
                    statusClass = 'status-refunded';
                    actionButtons = `<button class="btn-outline btn-small" disabled>è®¢å•å·²å…³é—­</button>`;
                } else if (order.status === 'completed') {
                    statusText = 'å·²å®Œæˆ';
                    statusClass = 'status-paid';
                    // å¯¹åº”æµç¨‹å›¾ï¼šå…¥ä½è¯„ä»·
                    actionButtons = `<button class="btn btn-small" onclick="openReviewModal()">âœï¸ å†™è¯„ä»·</button>`;
                }

                const html = `
                    <div class="card">
                        <div style="display:flex; justify-content:space-between; margin-bottom:10px; border-bottom:1px solid #eee; padding-bottom:10px;">
                            <span style="font-size:12px; color:gray;">è®¢å•å·: ${order.id}</span>
                            <span class="${statusClass}">${statusText}</span>
                        </div>
                        <div style="display:flex; gap:10px;">
                            <div style="width:60px; height:60px; background:#eee; border-radius:6px;"></div>
                            <div>
                                <div style="font-weight:bold;">${order.hotel}</div>
                                <div style="font-size:12px; color:gray;">${order.room}</div>
                                <div style="font-size:12px; color:gray;">${order.date}</div>
                            </div>
                        </div>
                        <div style="margin-top:15px; display:flex; justify-content:flex-end; gap:8px;">
                            ${actionButtons}
                        </div>
                    </div>
                `;
                container.innerHTML += html;
            });
        }

        // --- å”®åæ“ä½œäº¤äº’ ---

        // 1. é€€æ¬¾æµç¨‹ (å¯¹åº”ï¼šè‡ªèº«çªå‘æƒ…å†µ -> æ˜¯ -> æå‰é€€æ¬¾)
        function applyRefund(index) {
            if(confirm("ç¡®å®šè¦ç”³è¯·é€€æ¬¾å—ï¼Ÿæ ¹æ®æ”¿ç­–ï¼Œå°†åŸè·¯é€€å›æ”¯ä»˜è´¦æˆ·ã€‚")) {
                showToast("é€€æ¬¾ç”³è¯·æäº¤æˆåŠŸï¼Œå®¡æ ¸ä¸­...");
                setTimeout(() => {
                    state.orders[index].status = 'refunded';
                    renderOrderList(); // é‡æ–°æ¸²æŸ“çŠ¶æ€
                    showToast("èµ„é‡‘å·²é€€å› (æ¨¡æ‹Ÿ)");
                }, 1000);
            }
        }

        // 2. æ·»åŠ å…¥ä½æ—¥å† (å¯¹åº”ï¼šæ—¥ç¨‹æé†’)
        function addToCalendar() {
            showToast("å·²æ·»åŠ è‡³ç³»ç»Ÿæ—¥å† ğŸ“…");
        }

        // 3. æ¨¡æ‹Ÿå…¥ä½ (å¯¹åº”ï¼šåˆ°åº—å…¥ä½)
        function checkInAction() {
            showToast("æ¬¢è¿å…¥ä½ï¼æ¨¡æ‹Ÿè¡Œç¨‹ç»“æŸ");
            // ç®€å•å¤„ç†ï¼šå°†ç¬¬ä¸€æ¡å¾…å…¥ä½æ”¹ä¸ºå·²å®Œæˆï¼Œæ–¹ä¾¿å±•ç¤ºè¯„ä»·åŠŸèƒ½
            const targetIndex = state.orders.findIndex(o => o.status === 'upcoming');
            if(targetIndex !== -1) {
                state.orders[targetIndex].status = 'completed';
                setTimeout(() => renderOrderList(), 1000);
            }
        }

        // 4. è¯„ä»·æµç¨‹ (å¯¹åº”ï¼šå…¥ä½è¯„ä»·)
        function openReviewModal() {
            document.getElementById('review-modal').classList.add('show');
        }
        function submitReview() {
            closeModal('review-modal');
            showToast("è¯„ä»·å‘å¸ƒæˆåŠŸï¼æ„Ÿè°¢åé¦ˆ");
        }

        // --- å¼¹çª—ä¸è¾…åŠ©åŠŸèƒ½ ---
        function showFilterModal() { document.getElementById('filter-modal').classList.add('show'); }
        function showPolicyModal() { document.getElementById('policy-modal').classList.add('show'); }
        function showCouponModal() { document.getElementById('coupon-modal').classList.add('show'); }

        function closeModal(id) {
            document.getElementById(id).classList.remove('show');
        }

        function showToast(msg) {
            const toast = document.getElementById('toast');
            toast.innerText = msg;
            toast.style.display = 'block';
            setTimeout(() => toast.style.display = 'none', 2000);
        }

        // æµè§ˆå™¨åé€€é”®å¤„ç†
        window.onpopstate = function() {
            const active = document.querySelector('.page.active');
            if(active.id !== 'page-home') {
                router.push('page-home'); // ç®€å•å¤„ç†ï¼šç»Ÿä¸€å›é¦–é¡µ
            }
        };

    </script>
</body>
</html>